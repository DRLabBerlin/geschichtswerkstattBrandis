$(document).ready(function(){function e(){console.log("categoris to search for :"+r.join(", "));var e={};e.categories=r,e.action="getIdsByCategories",$.post(my_ajax_object.ajax_url,e,function(e){if("N"==e.error)if(App.drawMarkers(e.postIDs),App.timeline._timenav.highlight(e.postIDs),"undefined"!=typeof e.campaign_title){var t=' <div class="close_overlay"><a href="#" ><i class="mdi mdi-close icon"></i></a></div>';t+="<h2>"+e.campaign_title+"</h2>",t+="<p>"+e.campaign_txt+"</p>",$("#campaign").html(t),$("#campaign").show(),$(".close_overlay").click(function(e){e.preventDefault(),$("#campaign").html(""),$("#campaign").hide()})}else $("#campaign").html(""),$("#campaign").hide();else App.drawMarkers([]),App.timeline._timenav.highlight([]),console.log("Fehler::"+e.msg)},"json")}if("undefined"!=typeof App){App.tags=categories_json;var t={};App.filterControl,App.menuControl,App.mapInit=function(){var e=L.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),a=new L.StamenTileLayer("toner");App.map=new L.Map("map",{center:new L.LatLng(51.3329895,12.608),zoomControl:!1,zoom:13}),App.map.addLayer(a);var r=L.geoJson(geoJsonData,{pointToLayer:function(e,i){var a={dataId:e.id,className:"mySpecialClass",radius:8,fillColor:"#00b9cb",color:"#00b9cb",weight:1,opacity:.4,fillOpacity:.8};return t[e.id]=L.circleMarker(i,a).on("click",function(){App.showContent(e.id),console.log("funzt -> bin ID:"+e.id),App.timeline.goToId(e.id)}),t[e.id].id=e.id,t[e.id]},onEachFeature:function(e,t){var i=e.content}});marker_layer=new L.featureGroup;for(i in t)marker_layer.addLayer(t[i]);marker_layer.addTo(App.map),App.map.fitBounds(marker_layer.getBounds()),App.filterControl=L.Control.extend({options:{position:"bottomright"},onAdd:function(e){var t=L.DomUtil.create("div","menu-container "),a='<div class="clearfix"><a href="#" class="closeMenuButton pull-right "><i class="mdi mdi-close icon"></i></a></div> <ul id="categorylist-map">';a+='<li><a class="" id ="cat_neu" title="Neueste Beiträge">Neu</a></li>';for(i in App.tags)i<10&&(a+='<li><a data-index="'+App.tags[i].idx+'"  data-termid="'+App.tags[i].term_id+'" title="'+App.tags[i].description+'">'+App.tags[i].label+"</a></li>");return a+='<li id="search-li"><input type="text"  id="search-category"><input  type="hidden" id="search-category-id"></li>',a+="</ul>",t.innerHTML=a,t}}),App.menuControl=L.Control.extend({options:{position:"bottomright"},onAdd:function(e){var t=L.DomUtil.create("div","menu-open leaflet-bar"),i='<a href="#"><i class="mdi mdi-tag-multiple icon"></i></a>';return t.innerHTML=i,t}}),new L.Control.Zoom({position:"bottomright"}).addTo(App.map),$(".leaflet-control-zoom-in").html("<i class='mdi mdi-plus icon'></i>"),$(".leaflet-control-zoom-out").html("<i class='mdi mdi-minus icon'></i>"),App.this_menuControl=App.map.addControl(new App.menuControl),App.map.addControl(new App.filterControl),App.initCloseHandler(),App.initAutocomplete()},App.initCloseHandler=function(){$(".closeMenuButton").click(function(e){e.preventDefault(),$(".menu-container").hide(),$(".menu-open").show()})};var a=10;App.initAutocomplete=function(){$("#search-category").autocomplete({minLength:0,source:App.tags,focus:function(e,t){return $("#search-category").val(t.item.label),!1},change:function(e,t){console.log("change")},select:function(t,i){$("#search-category-id").val(i.item.term_id);var n=i.item.term_id;if(-1===$.inArray(n,r)&&r.push(n),e(),i.item.idx<=9)$("a[data-termid="+n+"] ").addClass("filter-active");else{var s='<li><a  class="filter-active" data-index="'+a+'" data-termid="'+n+'" title="'+i.item.description+'">'+i.item.label+"</a></li>";$(s).insertBefore("#search-li"),a++,App.initFilter()}return $("#search-category").val(""),!1}}).autocomplete("instance")._renderItem=function(e,t){var i=t.label.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(this.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");return $("<li></li>").data("item.autocomplete",t).append("<a> "+i+"</a>").appendTo(e)},$("#search-category").click(function(){$(this).focus()})},App.mapInit(),$(".menu-open > a").click(function(e){e.preventDefault(),$(".menu-open").hide(),$(".menu-container").show()}),App.drawMarkers=function(e){App.map.hasLayer(marker_layer)&&App.map.removeLayer(marker_layer),marker_layer=new L.featureGroup;for(i in geoJsonData[0].features)for(j in e){var a=geoJsonData[0].features[i].id;a==e[j]&&marker_layer.addLayer(t[a])}if(marker_layer.addTo(App.map),marker_layer.getLayers().length>1)App.map.fitBounds(marker_layer.getBounds());else if(1==marker_layer.getLayers().length){var r=marker_layer.getLayers();App.map.setView(r[0].getLatLng(),17)}},App.showContent=function(e){var t={};t.postID=e,t.action="getPostContent",$.post(my_ajax_object.ajax_url,t,function(e){if("N"==e.error){var t='<div id="contentOverlay"></div>';0==$("#contentOverlay").size()?$("body").append(t):$("#contentOverlay").remove();var i='<div class="close_overlay"><a href="#" ><i class="mdi mdi-close icon"></i></a></div>';i+="<h2>"+e.post_title+"</h2>",e.video&&(i+='<div class="videoWrapper">'+e.video+"</div>"),e.audio&&(i+='<div class="audioWrapper">',e.audio_bild&&(i+='<div class="audio_img">'+e.audio_bild+"</div>"),i+=e.audio+"</div>"),e.bilder&&(i+='<div class="sliderWrapper">',$.each(e.bilder,function(e,t){i+='<div class="slick-container">',i+='<img src="'+t.bild+'">',i+='<div class="caption">'+t.quelle+"</div>",i+="</div>"}),i+="</div>"),i+='<div class="content">'+e.post_content+"</div>",$("#contentOverlay").append(i),$(".sliderWrapper").length&&$(".sliderWrapper").slick({dots:!0,speed:500}),$(".close_overlay").click(function(e){e.preventDefault(),$("#contentOverlay").remove()})}else console.log("Fehler::"+e.msg)},"json")};var r=[];$("#category-form input[type=checkbox]").click(function(){if("cat_neu"==$(this).attr("id"))App.getNewest();else{if(1==$(this).prop("checked"))-1===$.inArray($(this).val(),r)&&r.push($(this).val());else{var t=$.inArray($(this).val(),r);r.splice(t,1)}console.log("category::"+$(this).val()+"---categories::"+r.join(", ")),r.length>0?e():(App.resetMarkers(),$("#campaign").html(""),$("#campaign").hide())}}),App.initFilter=function(){$("#categorylist-map li a").unbind("click"),$("#categorylist-map li a").bind("click",function(){if("cat_neu"==$(this).attr("id"))$(this).hasClass("filter-active")?($(this).removeClass("filter-active"),App.resetMarkers()):($(".filter-active").each(function(e,t){$(t).removeClass("filter-active")}),r=[],$(this).addClass("filter-active"),App.getNewest());else{$("#cat_neu").hasClass("filter-active")&&$("#cat_neu").removeClass("filter-active");var t=$(this).data("termid");if($(this).hasClass("filter-active")){var i=$.inArray(t,r);r.splice(i,1),$(this).removeClass("filter-active"),$(this).data("index")>9&&($(this).remove(),a--)}else-1===$.inArray(t,r)&&r.push(t),$(this).addClass("filter-active");console.log("category - init Filter::"+t+"---categories::"+r.join(", ")),r.length>0?e():(App.resetMarkers(),$("#campaign").html(""),$("#campaign").hide())}})},App.initFilter(),App.resetMarkers=function(){var e=[];for(i in t)e.push(t[i].id);App.drawMarkers(e),App.timeline._timenav.highlight([])},App.cleanUpCategories=function(){$("#category-form input[type=checkbox]").each(function(){this.checked&&$(this).attr("checked",!1),$(".menu-container").hide(),$(".menu-open").show()})},App.map.on("click",function(e){$("#contentOverlay").remove()}),App.getNewest=function(){var e={};e.action="getNewest",$.post(my_ajax_object.ajax_url,e,function(e){"N"==e.error?(App.drawMarkers(e.postIDs),App.timeline._timenav.highlight(e.postIDs)):console.log("Fehler::"+e.msg)},"json")};var n={start_at_slide:0,debug:!0,timenav_height_percentage:100,initial_zoom:1,language:"de",start_at_slide:parseInt(timeline_json.events.length/2)};App.timeline=new TL.Timeline("timeline",timeline_json,n),$("#timeline").delegate(".tl-timemarker","click",function(){tmp=this.id.split("-");var e=tmp[0];App.drawMarkers([e]),App.showContent(e),App.cleanUpCategories()})}if("undefined"!=typeof FilterApp){var s=[],o=[],l=$(".categorylist li a"),p=$(".item");""!=preselectedCat&&(s.push(preselectedCat),o.push(preselectedCatID),selector=s.join(", "),p.filter(selector).slideDown(),$("[data-filter='"+preselectedCat+"']").addClass("filter-active")),l.click(function(){if("cat_neu"==$(this).attr("id"))$(this).hasClass("filter-active")?$(this).removeClass("filter-active"):($(".filter-active").each(function(e,t){$(t).removeClass("filter-active")}),o=["cat_neu"],$(this).addClass("filter-active"),FilterApp.getFiltered());else{var e="",t=$(this).data("filter"),i=$(this).data("termid");$("#cat_neu").hasClass("filter-active")&&($("#cat_neu").removeClass("filter-active"),o=[]),$.inArray(t,s)<0?(s.push(t),o.push(i),FilterApp.getFiltered(),$(this).addClass("filter-active")):(s=$.grep(s,function(e){return e!=t}),o=$.grep(o,function(e){return e!=i}),FilterApp.getFiltered(),$(this).removeClass("filter-active"))}return!1}),FilterApp.getNewest=function(){var e={};e.action="getNewest",$.post(my_ajax_object.ajax_url,e,function(e){if($("#contentWrapper").slideUp("slow"),$("#contentWrapper tbody").empty(),"N"==e.error){var t=[];$.each(e.posts,function(t,i){var a="";a+='<tr class="item "><td class="zeitraum"><span>'+e.posts[t].displayDate+"</span></td>",a+='<td class="inhalt"><h2><a href="'+e.posts[t].permalink+'">'+e.posts[t].post_title+"</a></h2>",""!=e.posts[t].video&&(a+='<div class="videoWrapper">'+e.posts[t].video+"</div>"),a+="<div>"+e.posts[t].post_content+"</div>",a+="</td></tr>",$("#contentWrapper tbody").append(a),$("#contentWrapper").slideDown("slow")})}else{var i="";i+='<tr class="item "><td class="zeitraum"><span></span></td>',i+='<td class="inhalt"><div> Es gibt keine Einträge zu den gewählten Kriterien</div></td</tr>',$("#contentWrapper tbody").append(i),$("#contentWrapper").slideDown("slow")}},"json")},FilterApp.getFiltered=function(){if(c.indexOf(".")>0)var e=c.split("."),t=e[0];else var t=c;if(d.indexOf(".")>0)var e=d.split("."),i=e[0];else var i=d;var a={};a.min=t,a.max=i,a.filterArr=o,a.action="filterByYearAndKeyword",$.post(my_ajax_object.ajax_url,a,function(e){if($("#contentWrapper").slideUp("slow"),$("#contentWrapper tbody").empty(),"N"==e.error){var t=[];$.each(e.posts,function(t,i){var a="";a+='<tr class="item "><td class="zeitraum"><span>'+e.posts[t].displayDate+"</span></td>",a+='<td class="inhalt"><h2><a href="'+e.posts[t].permalink+'">'+e.posts[t].post_title+"</a></h2>",""!=e.posts[t].video&&(a+='<div class="videoWrapper">'+e.posts[t].video+"</div>"),e.posts[t].audio&&(a+='<div class="audioWrapper">',e.posts[t].audio_bild&&(a+='<div class="audio_img">'+e.posts[t].audio_bild+"</div>"),a+=e.posts[t].audio+"</div>"),e.posts[t].bilder&&(a+='<div class="sliderWrapper">',$.each(e.posts[t].bilder,function(e,t){a+='<div class="slick-container">',a+='<img src="'+t.bild+'">',a+='<div class="caption">'+t.quelle+"</div>",a+="</div>"}),a+="</div>"),a+="<div>"+e.posts[t].post_content+"</div>",a+="</td></tr>",$("#contentWrapper tbody").append(a),$("#contentWrapper").slideDown("slow"),$(".sliderWrapper").length&&$(".sliderWrapper").slick({dots:!0,speed:500})})}else{var i="";i+='<tr class="item "><td class="zeitraum"><span></span></td>',i+='<td class="inhalt"><div> Es gibt keine Einträge zu den gewählten Kriterien</div></td</tr>',$("#contentWrapper tbody").append(i),$("#contentWrapper").slideDown("slow")}},"json")};var c=sliderStart,d=sliderEnd,m=!1;$("#slider").editRangeSlider({arrows:!1,bounds:{min:parseInt(startYear),max:parseInt(thisYear)},defaultValues:{min:sliderStart,max:sliderEnd}}),$("#slider").on("valuesChanged",function(e,t){console.log("Something moved. min: "+t.values.min+" max: "+t.values.max),(String(t.values.min)!=sliderStart||String(t.values.max)!=sliderEnd||1==m)&&(m=!0,c=String(t.values.min),d=String(t.values.max),FilterApp.getFiltered())})}$(".sliderWrapper").length&&$(".sliderWrapper").slick({dots:!0,speed:500})});